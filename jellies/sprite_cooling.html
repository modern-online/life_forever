<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pixel Jellyfish — Cooling Down (Aligned Thermometer)</title>
  <style>
    :root{
      --cell: 12px;   /* pixel size */
      --gap:  2px;    /* pixel gap */
      --bg:   #111;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); height:100vh;
      display:grid; place-items:center; image-rendering:pixelated;
      font-family:system-ui, sans-serif;
    }

    .scene{
      display:flex; align-items:center; gap:14px;
    }

    /* Generic pixel cell + grid helper */
    .px{ width:var(--cell); height:var(--cell); background:transparent; }
    .grid{ display:grid; gap:var(--gap); }

    /* ---------- Thermometer (3x6) — aligned to jelly height ---------- */
    .thermo{ grid-template-columns:repeat(3,var(--cell)); grid-template-rows:repeat(6,var(--cell)); }
    .tglass{ background:#444; }
    .tfill{  background:#ff6a3a; } /* set by JS as inline background */

    /* ---------- Jelly (5x6) ---------- */
    .jelly{ grid-template-columns:repeat(5,var(--cell)); grid-template-rows:repeat(6,var(--cell)); }
    .body { background:#ff6666; transition:background .1s steps(1); }
    .tent { background:#ff8844; transition:background .1s steps(1); }

    /* ---------- Sparkles (cooling completed) ---------- */
    .sparkleBox{
      position:relative; width:calc(5*var(--cell) + 4*var(--gap));
      height:calc(6*var(--cell) + 5*var(--gap));
      margin-left: 6px;  /* nudge to sit over jelly a bit */
      pointer-events:none;
    }
    .sp{
      position:absolute; width:var(--cell); height:var(--cell); background:transparent;
    }
    .on { background:#c8f4ff; } /* cool sparkle blue */
  </style>
</head>
<body>
  <div class="scene">
    <!-- THERMOMETER (left) — now 3x6 rows -->
    <div class="grid thermo" id="thermo">
      <!-- Row 0 -->
      <div class="tglass"></div><div class="tglass"></div><div class="tglass"></div>
      <!-- Row 1 -->
      <div class="tglass"></div><div class="tglass"></div><div class="tglass"></div>
      <!-- Row 2 -->
      <div class="tglass"></div><div class="tglass"></div><div class="tglass"></div>
      <!-- Row 3 -->
      <div class="tglass"></div><div class="tglass"></div><div class="tglass"></div>
      <!-- Row 4 -->
      <div class="tglass"></div><div class="tglass"></div><div class="tglass"></div>
      <!-- Row 5 (bulb / bottom) -->
      <div class="tglass"></div><div class="tglass"></div><div class="tglass"></div>
    </div>

    <!-- JELLY -->
    <div style="position:relative; display:flex; align-items:center;">
      <div class="grid jelly" id="jelly">
        <!-- Row 0 -->
        <div class="px"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="px"></div>
        <!-- Row 1 -->
        <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div>
        <!-- Row 2 -->
        <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div>
        <!-- Row 3 -->
        <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div>
        <!-- Row 4 -->
        <div class="tent"></div><div class="tent"></div><div class="tent"></div><div class="tent"></div><div class="tent"></div>
        <!-- Row 5 -->
        <div class="tent"></div><div class="px"></div><div class="tent"></div><div class="px"></div><div class="tent"></div>
      </div>

      <!-- Sparkles overlay (appears only when fully cooled) -->
      <div class="sparkleBox" id="sparkles">
        <!-- place a few sparkle pixels around -->
        <div class="sp" style="left:0;top:0;"></div>
        <div class="sp" style="left:calc(3*var(--cell));top:0;"></div>
        <div class="sp" style="left:calc(1*var(--cell));top:calc(2*var(--cell));"></div>
        <div class="sp" style="left:calc(4*var(--cell));top:calc(1*var(--cell));"></div>
        <div class="sp" style="left:calc(2*var(--cell));top:calc(4*var(--cell));"></div>
      </div>
    </div>
  </div>

  <script>
    /* ---------------- cooling phases ---------------- */
    const phases = [
      { body:'#ff6666', tent:'#ff8844', fill:'#ff6a3a' }, // hottest
      { body:'#ff7c66', tent:'#ff9950', fill:'#ff7a4e' },
      { body:'#ffa066', tent:'#ffad66', fill:'#ff9b6f' },
      { body:'#ffd166', tent:'#ffc466', fill:'#ffc06e' },
      { body:'#a6e6ff', tent:'#6fc8ff', fill:'#6fc8ff' },
      { body:'#66ccff', tent:'#3399ff', fill:'#3fb2ff' }  // fully cool
    ];

    // DOM refs
    const bodyPixels = Array.from(document.querySelectorAll('.body'));
    const tentPixels = Array.from(document.querySelectorAll('.tent'));
    const thermoCells = Array.from(document.querySelectorAll('#thermo > div'));
    const sparkles = Array.from(document.querySelectorAll('#sparkles .sp'));

    // Thermometer layout (3x6): bottom row (row 5) is the bulb, fill from rows 4→0
    const TH_COL = 1; // center column
    const TH_ROWS = 6;

    function setThermoLevel(level, fillColor){
      // reset to glass (remove inline colors)
      thermoCells.forEach(c => { c.className='tglass'; c.style.background=''; });

      // bulb (row 5) always lit in center column
      const bulbIdx = (TH_ROWS - 1) * 3 + TH_COL; // row 5, col 1
      thermoCells[bulbIdx].style.background = fillColor;

      // fill tube from row 4 up to row (4 - (level-1))
      // level is 0..TH_ROWS-1 => 0..5
      const maxTubeRow = TH_ROWS - 2; // 4
      for (let r = maxTubeRow; r >= maxTubeRow - level; r--){
        if (r < 0) break;
        const i = r * 3 + TH_COL;
        thermoCells[i].style.background = fillColor;
      }
    }

    // Apply a phase’s colors
    function applyPhase(p){
      bodyPixels.forEach(b => b.style.background = p.body);
      tentPixels.forEach(t => t.style.background = tActive ? brighten(p.tent) : p.tent);
      setThermoLevel(currentPhase, p.fill);
    }

    // Slight brighten helper when tentacles are “active”
    function brighten(hex){
      const c = hex.replace('#','');
      const r = parseInt(c.slice(0,2),16), g = parseInt(c.slice(2,4),16), b = parseInt(c.slice(4,6),16);
      const mix = (v)=> Math.min(255, Math.round(v*0.7 + 255*0.3));
      return `rgb(${mix(r)},${mix(g)},${mix(b)})`;
    }

    // Tentacle sway (slows as it cools)
    let tTick = 0;
    let tActive = true; // tentacles “energetic” while still hot
    function swayTentacles(){
      const p = phases[currentPhase];
      const base = p.tent;
      const alt = 'transparent';
      tentPixels.forEach((t,i)=>{
        t.style.background = ((i + tTick) % 2 === 0) ? (tActive ? brighten(base) : base) : alt;
      });
      tTick = (tTick + 1) % 2;
    }

    // Sparkles blink only when fully cooled
    function blinkSparkles(on){
      if (!on){
        sparkles.forEach(s=> s.classList.remove('on'));
        return;
      }
      sparkles.forEach((s,i)=>{
        if ((i + Math.floor(Date.now()/300)) % 2 === 0) s.classList.add('on');
        else s.classList.remove('on');
      });
    }

    // Cooling progression
    let currentPhase = 0; // start hot
    applyPhase(phases[currentPhase]);

    const STEP_MS = 900;
    const phaseTimer = setInterval(()=>{
      currentPhase = Math.min(phases.length-1, currentPhase + 1);
      tActive = currentPhase < phases.length-2; // less active near the end
      applyPhase(phases[currentPhase]);

      if (currentPhase === phases.length-1){
        clearInterval(phaseTimer);
        blinkCool = true;
      }
    }, STEP_MS);

    // Animation loops: tentacles + sparkles
    let blinkCool = false;
    setInterval(()=>{
      swayTentacles();
      blinkSparkles(blinkCool);
    }, 450);
  </script>
</body>
</html>
