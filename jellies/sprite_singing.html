<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jellyfish: Arced Waves + Moving Tentacles</title>
  <style>
    body {
      margin: 0;
      background: #111;
      height: 100vh;
      display: grid;
      place-items: center;
      image-rendering: pixelated;
    }

    .scene {
      display: flex;
      align-items: center;
      gap: 10px; /* jelly <-> waves */
    }

    :root {
      --cell: 12px;  /* pixel size */
      --gap:  2px;   /* pixel gap */
    }

    /* Jellyfish grid (5x6) */
    .jelly {
      display: grid;
      grid-template-columns: repeat(5, var(--cell));
      grid-template-rows: repeat(6, var(--cell));
      gap: var(--gap);
    }
    .px { width: var(--cell); height: var(--cell); background: transparent; }
    .body { background: #66ccff; transition: background .2s steps(1); }
    .tent { background: #3399ff; transition: background .2s steps(1); }
    .mouth { background: #66ccff; } /* JS toggles this to transparent when open */

    /* Waves grid (3 cols so we can place base x and x+1 arc edges) */
    .waves {
      display: grid;
      grid-template-columns: repeat(3, var(--cell)); /* col 0 = x, col 1 = x+1, col 2 spare */
      grid-template-rows: repeat(7, var(--cell));
      gap: var(--gap);
    }
    .wavepx { width: var(--cell); height: var(--cell); background: transparent; }
    .on { background: #ffff66; }
  </style>
</head>
<body>
  <div class="scene">
    <!-- JELLYFISH (mouth at row 2, rightmost cell) -->
    <div class="jelly" id="jelly">
      <!-- Row 0 -->
      <div class="px"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="px"></div>
      <!-- Row 1 -->
      <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div>
      <!-- Row 2 (mouth here) -->
      <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="mouth" id="mouth"></div>
      <!-- Row 3 -->
      <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div>
      <!-- Row 4 (tentacles row 1) -->
      <div class="tent"></div><div class="tent"></div><div class="tent"></div><div class="tent"></div><div class="tent"></div>
      <!-- Row 5 (tentacles row 2 with gaps) -->
      <div class="tent"></div><div class="px"></div><div class="tent"></div><div class="px"></div><div class="tent"></div>
    </div>

    <!-- WAVES: expanding arc where top/bottom pixels are at x+1 -->
    <div class="waves" id="waves">
      <!-- 3 columns × 7 rows = 21 slots -->
      <!-- Row 0 -->
      <div class="wavepx"></div><div class="wavepx"></div><div class="wavepx"></div>
      <!-- Row 1 -->
      <div class="wavepx"></div><div class="wavepx"></div><div class="wavepx"></div>
      <!-- Row 2 (aligned with mouth row) -->
      <div class="wavepx"></div><div class="wavepx"></div><div class="wavepx"></div>
      <!-- Row 3 -->
      <div class="wavepx"></div><div class="wavepx"></div><div class="wavepx"></div>
      <!-- Row 4 -->
      <div class="wavepx"></div><div class="wavepx"></div><div class="wavepx"></div>
      <!-- Row 5 -->
      <div class="wavepx"></div><div class="wavepx"></div><div class="wavepx"></div>
      <!-- Row 6 -->
      <div class="wavepx"></div><div class="wavepx"></div><div class="wavepx"></div>
    </div>
  </div>

  <script>
    // --- Waves setup (arched rule) ---
    const W = 3;  // cols: 0 (x), 1 (x+1), 2 spare
    const H = 7;  // rows
    const BASE_COL = 0;
    const EDGE_COL = 1;
    const mouthRow = 2;  // aligned with jelly’s mouth (row 2)

    const waves = Array.from(document.querySelectorAll('.waves .wavepx'));
    const mouth = document.getElementById('mouth');

    const idx = (r, c) => r * W + c;

    // Frame builder per your rule:
    // For length L:
    //  - odd L: include center row (mouthRow). Top/bottom rows at EDGE_COL (x+1), inner rows at BASE_COL (x).
    //  - even L: symmetric rows around mouthRow. Extremes at EDGE_COL, inner at BASE_COL.
    const lengths = [1, 2, 3, 4, 5, 6];
    function frameForLength(L) {
      const rows = [];
      if (L % 2 === 1) {
        const r0 = Math.floor(L / 2);
        for (let dy = -r0; dy <= r0; dy++) {
          const r = mouthRow + dy;
          if (r < 0 || r >= H) continue;
          const isEdge = (Math.abs(dy) === r0) && L > 1;
          rows.push([r, isEdge ? EDGE_COL : BASE_COL]);
        }
      } else {
        const r0 = L / 2;
        for (let dy = -r0; dy < r0; dy++) {
          const r = mouthRow + dy;
          if (r < 0 || r >= H) continue;
          const isEdge = (dy === -r0 || dy === (r0 - 1));
          rows.push([r, isEdge ? EDGE_COL : BASE_COL]);
        }
      }
      return rows;
    }
    const frames = lengths.map(frameForLength);

    // --- Tentacle animation (sway) ---
    const tentacles = document.querySelectorAll('.tent');
    let tentToggle = false;

    // --- Animation loop ---
    let step = 0;
    setInterval(() => {
      // Clear waves
      waves.forEach(p => p.classList.remove('on'));

      // Blink mouth: open (transparent) / closed (filled)
      mouth.style.background = (step % 2 === 0) ? 'transparent' : '#66ccff';

      // Light current arced frame
      frames[step].forEach(([r, c]) => {
        const i = idx(r, c);
        if (i >= 0 && i < waves.length) waves[i].classList.add('on');
      });

      // Tentacles sway (toggle some pixels off)
      tentacles.forEach((t, i) => {
        // simple checker: alternate visibility by index + toggle
        t.style.background = ((i + (tentToggle ? 1 : 0)) % 2 === 0) ? '#3399ff' : 'transparent';
      });
      tentToggle = !tentToggle;

      // Next frame
      step = (step + 1) % frames.length;
    }, 420);
  </script>
</body>
</html>
