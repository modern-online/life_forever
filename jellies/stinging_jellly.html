<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jelly — Sting (Unified)</title>
  <style>
    :root{
      --cell:12px; --gap:2px; --bg:#111;
      --body:#66ccff; --bodyFlash:#aee6ff; --tent:#3399ff;
      --sting:#ffea3a;  /* yellow */
      --hurt:#ff3b30;   /* red */
    }
    *{box-sizing:border-box}
    body{ margin:0; background:var(--bg); height:100vh; display:grid; place-items:center; image-rendering:pixelated; font-family:system-ui,sans-serif; }

    .scene{ display:flex; flex-direction:column; align-items:center; gap:0; }

    /* Jelly 5×6 */
    .jelly{
      display:grid; gap:var(--gap);
      grid-template-columns:repeat(5,var(--cell));
      grid-template-rows:repeat(6,var(--cell));
    }
    .px{ width:var(--cell); height:var(--cell); background:transparent; }
    .body{ background:var(--body); transition:background .1s steps(1); }
    .tent{ background:var(--tent); transition:background .1s steps(1); }

    /* Strike zone 5×4 (touching tentacles) */
    .strike{
      display:grid; gap:var(--gap);
      grid-template-columns:repeat(5,var(--cell));
      grid-template-rows:repeat(4,var(--cell));
    }
    .s{ width:var(--cell); height:var(--cell); background:transparent; }
    .on{ background:var(--sting); }
    .hurt{ background:var(--hurt); }
  </style>
</head>
<body>
  <div class="scene">
    <!-- JELLY -->
    <div class="jelly" id="jelly">
      <!-- Row 0 -->
      <div class="px"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="px"></div>
      <!-- Row 1 -->
      <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div>
      <!-- Row 2 -->
      <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div>
      <!-- Row 3 -->
      <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div>
      <!-- Row 4 (tentacles) -->
      <div class="tent"></div><div class="tent"></div><div class="tent"></div><div class="tent"></div><div class="tent"></div>
      <!-- Row 5 (tentacles w/ gaps) -->
      <div class="tent"></div><div class="px"></div><div class="tent"></div><div class="px"></div><div class="tent"></div>
    </div>

    <!-- STRIKE (no gap) -->
    <div class="strike" id="strike">
      <!-- 5 × 4 -->
      <div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div>
      <div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div>
      <div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div>
      <div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div>
    </div>
  </div>

  <script>
    // helpers
    const W=5,H=4, idx=(r,c)=>r*W+c;
    const strike = Array.from(document.querySelectorAll('#strike .s'));
    const bodyPx = Array.from(document.querySelectorAll('#jelly .body'));
    const tent   = Array.from(document.querySelectorAll('#jelly .tent'));

    // frames: tapering yellow → red impact splash → retract
    const extendFrames = [
      [[0,0,'on'],[0,2,'on'],[0,4,'on']],
      [[1,1,'on'],[1,2,'on'],[1,3,'on']],
      [[2,2,'on']],
      [[3,1,'hurt'],[3,2,'hurt'],[3,3,'hurt']],
      [[3,0,'hurt'],[3,1,'hurt'],[3,2,'hurt'],[3,3,'hurt'],[3,4,'hurt']],
      [[3,1,'hurt'],[3,2,'hurt'],[3,3,'hurt'],[2,1,'hurt'],[2,3,'hurt']]
    ];
    const retractFrames = [
      [[3,1,'hurt'],[3,2,'hurt'],[3,3,'hurt']],
      [[2,2,'on']],
      [[1,1,'on'],[1,2,'on'],[1,3,'on']],
      [[0,0,'on'],[0,2,'on'],[0,4,'on']]
    ];
    const frames=[...extendFrames,...retractFrames];

    function clearStrike(){ strike.forEach(px=> px.className='s'); }
    function drawFrame(list){
      list.forEach(([r,c,klass])=>{
        const k=idx(r,c); if(k>=0 && k<strike.length) strike[k].classList.add(klass);
      });
    }

    // unified tempos
    const STRIKE_MS = 120;    // strike frame cadence
    const SWAY_MS   = 450;    // tentacle sway

    // idle tentacle sway
    let swayTick=0;
    setInterval(()=>{
      tent.forEach((t,i)=> t.style.background = ((i + swayTick) % 2 === 0) ? 'var(--tent)' : 'transparent');
      swayTick = (swayTick+1)%2;
    }, SWAY_MS);

    // sting loop (attack ↔ idle)
    let step=0, attacking=false;
    setInterval(()=>{
      clearStrike();
      if (step===0) attacking=!attacking;

      bodyPx.forEach(b=> b.style.background = attacking ? 'var(--bodyFlash)' : 'var(--body)');
      if (attacking) drawFrame(frames[step]);

      step=(step+1)%frames.length;
    }, STRIKE_MS);
  </script>
</body>
</html>
