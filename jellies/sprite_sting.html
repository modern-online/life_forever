<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pixel Jellyfish — Big Painful Sting</title>
  <style>
    :root{
      --cell: 12px;
      --gap:  2px;
      --bg: #111;

      --body: #66ccff;
      --bodyFlash: #aee6ff;
      --tent: #3399ff;

      --sting: #ffea3a;   /* yellow */
      --hurt:  #ff3b30;   /* red (impact pain) */
    }

    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); height:100vh;
      display:grid; place-items:center; image-rendering:pixelated;
      font-family:system-ui, sans-serif;
    }

    /* No gap between jelly and strike */
    .scene{
      display:flex; flex-direction:column; align-items:center; gap:0;
    }

    /* Jelly (5x6) */
    .jelly{
      display:grid; gap:var(--gap);
      grid-template-columns:repeat(5,var(--cell));
      grid-template-rows:repeat(6,var(--cell));
    }
    .px{width:var(--cell); height:var(--cell); background:transparent;}
    .body{background:var(--body); transition:background .1s steps(1);}
    .tent{background:var(--tent); transition:background .1s steps(1);}

    /* Strike zone (5x4) — immediately under tentacles */
    .strike{
      display:grid; gap:var(--gap);
      grid-template-columns:repeat(5,var(--cell));
      grid-template-rows:repeat(4,var(--cell));
    }
    .s{width:var(--cell); height:var(--cell); background:transparent;}
    .on{background:var(--sting);}   /* yellow stinger */
    .hurt{background:var(--hurt);}  /* red impact */
  </style>
</head>
<body>
  <div class="scene">
    <!-- JELLYFISH -->
    <div class="jelly" id="jelly">
      <!-- Row 0 -->
      <div class="px"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="px"></div>
      <!-- Row 1 -->
      <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div>
      <!-- Row 2 -->
      <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div>
      <!-- Row 3 -->
      <div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div><div class="body"></div>
      <!-- Row 4 (tentacles row 1) -->
      <div class="tent"></div><div class="tent"></div><div class="tent"></div><div class="tent"></div><div class="tent"></div>
      <!-- Row 5 (tentacles row 2 with gaps) -->
      <div class="tent"></div><div class="px"></div><div class="tent"></div><div class="px"></div><div class="tent"></div>
    </div>

    <!-- STRIKE ZONE (no gap) -->
    <div class="strike" id="strike">
      <!-- 5 x 4 cells -->
      <!-- Row 0 --> <div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div>
      <!-- Row 1 --> <div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div>
      <!-- Row 2 --> <div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div>
      <!-- Row 3 --> <div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div><div class="s"></div>
    </div>
  </div>

  <script>
    /* ---------- helpers ---------- */
    const W = 5, H = 4;
    const idx = (r,c) => r*W + c;

    const strike = Array.from(document.querySelectorAll('#strike .s'));
    const bodyPixels = Array.from(document.querySelectorAll('#jelly .body'));
    const tentacles  = Array.from(document.querySelectorAll('#jelly .tent'));

    /* ---------- frames ----------
       Tapered yellow stinger that starts under tentacles,
       then a big red impact splash at the bottom (more red pixels),
       then retract.

       Rows (0 is just below tentacles, 3 is bottom):
       0: YELLOW at [0,0], [0,2], [0,4]
       1: YELLOW at [1,1], [1,2], [1,3]
       2: YELLOW at [2,2]
       3: RED IMPACT (painful): first [3,1],[3,2],[3,3],
          then a wider red splash including row 2 edges for emphasis,
          then retract.
    */
    const extendFrames = [
      // build-up (yellow)
      [ [0,0,'on'], [0,2,'on'], [0,4,'on'] ],
      [ [1,1,'on'], [1,2,'on'], [1,3,'on'] ],
      [ [2,2,'on'] ],

      // impact burst (more RED at bottom!)
      [ [3,1,'hurt'], [3,2,'hurt'], [3,3,'hurt'] ],                         // first hit
      [ [3,0,'hurt'], [3,1,'hurt'], [3,2,'hurt'], [3,3,'hurt'], [3,4,'hurt'] ], // big red floor
      [ [3,1,'hurt'], [3,2,'hurt'], [3,3,'hurt'], [2,1,'hurt'], [2,3,'hurt'] ], // splash up a bit
    ];

    const retractFrames = [
      [ [3,1,'hurt'], [3,2,'hurt'], [3,3,'hurt'] ], // brief lingering pain
      [ [2,2,'on'] ],
      [ [1,1,'on'], [1,2,'on'], [1,3,'on'] ],
      [ [0,0,'on'], [0,2,'on'], [0,4,'on'] ],
    ];

    const frames = [...extendFrames, ...retractFrames];

    /* ---------- animation ---------- */
    const INTERVAL = 120;
    let step = 0;
    let attacking = false;

    function clearStrike(){
      strike.forEach(px => px.className = 's');
    }
    function drawFrame(list){
      list.forEach(([r,c,klass]) => {
        const k = idx(r,c);
        if (k>=0 && k<strike.length) strike[k].classList.add(klass);
      });
    }

    // Tentacle sway when idle
    function swayTentacles(){
      tentacles.forEach((t,i) => {
        t.style.background = ((i + Math.floor(Date.now()/300)) % 2 === 0)
          ? 'var(--tent)' : 'transparent';
      });
    }

    setInterval(() => {
      clearStrike();

      // toggle attack phase at start
      if (step === 0) attacking = !attacking;

      // body flash at sting start
      bodyPixels.forEach(b => {
        b.style.background = attacking ? 'var(--bodyFlash)' : 'var(--body)';
      });

      // tentacles: bright during attack, sway when idle
      if (attacking){
        tentacles.forEach(t => t.style.background = '#ffee66');
      } else {
        swayTentacles();
      }

      // draw stinger only in attack phase
      if (attacking){
        drawFrame(frames[step]);
      }

      step = (step + 1) % frames.length;
    }, INTERVAL);
  </script>
</body>
</html>
